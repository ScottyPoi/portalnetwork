
  /**
   * @license
   * author: acolytec3
   * portalnetwork.js v0.0.1
   * Released under the MIT license.
   */

import { KademliaRoutingTable } from '@chainsafe/discv5';
export { Discv5 } from '@chainsafe/discv5';
import { BN } from 'bn.js';

const MODULO = new BN(2).pow(new BN(256));
const MID = new BN(2).pow(new BN(255));
const distance = (id1, id2) => {
    const num1 = new BN(id1);
    const num2 = new BN(id2);
    let diff;
    num1.gt(num2) ? diff = num1.sub(num2) : diff = num2.sub(num1);
    diff.gt(MID) ? diff = MODULO.sub(diff) : diff;
    return diff;
};

class OverlayRoutingTable extends KademliaRoutingTable {
    nearest(id, limit) {
        const results = [];
        this.buckets.forEach((bucket) => {
            results.push(...bucket.values());
        });
        results.sort((a, b) => {
            const diff = distance(id, a.nodeId).sub(distance(id, b.nodeId));
            if (diff.isNeg())
                return -1;
            if (diff.isZero())
                return 0;
            return 1;
        });
        return results.slice(0, limit);
    }
}

export { OverlayRoutingTable, distance };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9ydGFsbmV0d29yay5lcy5qcyIsInNvdXJjZXMiOlsiLi4vc3JjL3NyYy9kaHQvdXRpbC50cyIsIi4uL3NyYy9zcmMvZGh0L2RodC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBCTiB9IGZyb20gJ2JuLmpzJztcblxuY29uc3QgTU9EVUxPID0gbmV3IEJOKDIpLnBvdyhuZXcgQk4oMjU2KSlcbmNvbnN0IE1JRCA9IG5ldyBCTigyKS5wb3cobmV3IEJOKDI1NSkpXG5cbmV4cG9ydCBjb25zdCBkaXN0YW5jZSA9IChpZDE6IHN0cmluZywgaWQyOiBzdHJpbmcpID0+IHtcbiAgICBjb25zdCBudW0xID0gbmV3IEJOKGlkMSk7XG4gICAgY29uc3QgbnVtMiA9IG5ldyBCTihpZDIpO1xuXG4gICAgbGV0IGRpZmZcbiAgICBudW0xLmd0KG51bTIpID8gZGlmZiA9IG51bTEuc3ViKG51bTIpIDogZGlmZiA9IG51bTIuc3ViKG51bTEpXG4gICAgZGlmZi5ndChNSUQpID8gZGlmZiA9IE1PRFVMTy5zdWIoZGlmZikgOiBkaWZmXG4gICAgcmV0dXJuIGRpZmZcbn0iLCJpbXBvcnQgeyBFTlIsIEthZGVtbGlhUm91dGluZ1RhYmxlLCBOb2RlSWQgfSBmcm9tICdAY2hhaW5zYWZlL2Rpc2N2NSdcbmltcG9ydCB7IEJOIH0gZnJvbSAnYm4uanMnO1xuaW1wb3J0IHsgZGlzdGFuY2UgfSBmcm9tICcuL3V0aWwnXG5cblxuZXhwb3J0IGNsYXNzIE92ZXJsYXlSb3V0aW5nVGFibGUgZXh0ZW5kcyBLYWRlbWxpYVJvdXRpbmdUYWJsZSB7XG4gICAgbmVhcmVzdChpZDogTm9kZUlkLCBsaW1pdDogbnVtYmVyKTogRU5SW10ge1xuICAgICAgICBjb25zdCByZXN1bHRzOiBFTlJbXSA9IFtdO1xuICAgICAgICB0aGlzLmJ1Y2tldHMuZm9yRWFjaCgoYnVja2V0KSA9PiB7XG4gICAgICAgICAgICByZXN1bHRzLnB1c2goLi4uYnVja2V0LnZhbHVlcygpKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJlc3VsdHMuc29ydCgoYSwgYikgPT4ge1xuICAgICAgICAgICAgY29uc3QgZGlmZiA9IGRpc3RhbmNlKGlkLCBhLm5vZGVJZCkuc3ViKGRpc3RhbmNlKGlkLCBiLm5vZGVJZCkpO1xuICAgICAgICAgICAgaWYgKGRpZmYuaXNOZWcoKSkgcmV0dXJuIC0xO1xuICAgICAgICAgICAgaWYgKGRpZmYuaXNaZXJvKCkpIHJldHVybiAwO1xuICAgICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgIH0pXG4gICAgICAgIHJldHVybiByZXN1bHRzLnNsaWNlKDAsIGxpbWl0KTtcbiAgICB9XG59Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUVBLE1BQU0sTUFBTSxHQUFHLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFBO0FBQ3pDLE1BQU0sR0FBRyxHQUFHLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFBO01BRXpCLFFBQVEsR0FBRyxDQUFDLEdBQVcsRUFBRSxHQUFXO0lBQzdDLE1BQU0sSUFBSSxHQUFHLElBQUksRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ3pCLE1BQU0sSUFBSSxHQUFHLElBQUksRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBRXpCLElBQUksSUFBSSxDQUFBO0lBQ1IsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsR0FBRyxJQUFJLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxJQUFJLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQTtJQUM3RCxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxHQUFHLElBQUksR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQTtJQUM3QyxPQUFPLElBQUksQ0FBQTtBQUNmOztNQ1JhLG1CQUFvQixTQUFRLG9CQUFvQjtJQUN6RCxPQUFPLENBQUMsRUFBVSxFQUFFLEtBQWE7UUFDN0IsTUFBTSxPQUFPLEdBQVUsRUFBRSxDQUFDO1FBQzFCLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUMsTUFBTTtZQUN4QixPQUFPLENBQUMsSUFBSSxDQUFDLEdBQUcsTUFBTSxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUM7U0FDcEMsQ0FBQyxDQUFDO1FBQ0gsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO1lBQ2QsTUFBTSxJQUFJLEdBQUcsUUFBUSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7WUFDaEUsSUFBSSxJQUFJLENBQUMsS0FBSyxFQUFFO2dCQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUM7WUFDNUIsSUFBSSxJQUFJLENBQUMsTUFBTSxFQUFFO2dCQUFFLE9BQU8sQ0FBQyxDQUFDO1lBQzVCLE9BQU8sQ0FBQyxDQUFDO1NBQ1osQ0FBQyxDQUFBO1FBQ0YsT0FBTyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQztLQUNsQzs7Ozs7In0=
